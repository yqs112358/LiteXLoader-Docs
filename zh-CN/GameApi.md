# LiteXLoader - 游戏元素接口文档

[<< 返回目录](README.md)

下列这些API，提供了对游戏内容进行**修改**和**扩展**的能力。  
他们将是你编写插件，与大多数游戏元素互动的时候最为关键的部分。  

<br>

## 命令注册 API

下面这些API提供了在游戏中注册、监听自定义命令的接口

### 执行一条后台命令  

`mc.runcmd(cmd)`

- 参数：
  - cmd : `String`  
    待执行的命令  
- 返回值：是否执行成功
- 返回值类型： `Boolean`

<br>

### 执行一条后台命令（强化版）  

`mc.runcmdEx(cmd)`

- 参数：

  - cmd : `String`  
    待执行的命令  

- 返回值：命令执行结果`Object` 

- 返回值类型： `Object<Boolean,String>`

  - 对于返回的某个执行结果对象res，有如下这些成员：  

  | 成员       | 含义                    | 类型      |
  | ---------- | ----------------------- | --------- |
  | res.result | 是否执行成功            | `Boolean` |
  | res.output | BDS执行命令后的输出结果 | `String`  |


> 注：runcmdEx 与普通 runcmd 实现区别非常大，在于 Ex 版本拥有**隐藏执行**的机制，执行结果不会输出至控制台，因此如果有需要，要手动用 log 函数将结果输出

<br>

### 注册一个新的玩家命令  

`mc.addPlayerCmd(cmd,description,callback[,level])`

- 参数：
  - cmd : `String`  
    待注册的命令
  - description : `String`  
    命令描述文本  
  - callback : `Function`  
    注册的这个命令被执行时，接口自动调用的回调函数。
  - level : `Integer`  
    （可选参数）命令的注册等级，默认为 0 ，即所有人都可以执行  
    如果设置命令注册等级为1，则只有OP可以执行此命令  
- 返回值：是否成功注册
- 返回值类型：`Boolean`

注：参数callback的回调函数原型：`function(player,args)`  

- player : `Player`  
  执行命令的玩家对象
- args : `Array<String,String...>`    
  按空格为分界分割，得到的命令字符串数组

如果在回调函数中返回`false`，等同于拦截这个命令的执行。

<br>

### 注册一个新的后台控制台命令  

`mc.addConsoleCmd(cmd,description,callback)`

- 参数：
  - cmd : `String`  
    待注册的命令

  - description : `String`  
    命令描述文本  

  - callback : `Function`  
    注册的这个命令被执行时，接口自动调用的回调函数。  
- 返回值：是否成功注册
- 返回值类型：`Boolean`

注：参数callback的回调函数原型：`function(args)`  

- args : `Array<String,String...>`    
  按空格为分界分割，得到的命令字符串数组

如果在回调函数中返回`false`，等同于拦截这个命令的执行。

<br>

### 命令注册相关说明

设置了回调函数之后，在你注册的这个命令被执行的时候，回调函数就会被调用。  
在调用之前，LXL会自动帮你把命令参数分割成数组。  

以Js语言为例：执行注册`mc.registerCmd("land buy", "购买领地", 0, function(args){ .... } );` 之后，  
当你使用命令`/land buy abcde 12345`的时候，这个回调函数就会被调用。  
回调函数的参数args被传入一个数组：[ "land buy", "abcde" , "12345" ]  
正如所见，`args[0]`为注册的这个命令本身，后面按顺序是被分割好的参数。  
如果你的命令中有引号（比如说为了处理含有空格的玩家名字），LXL在分割时也会做处理。

在调用回调函数之后，如果你没有拦截，传统的的命令执行事件仍然会被正常触发一次。  
如果你不喜欢回调函数的这种形式，可以在这里设置个空函数，继续使用传统的命令监听方式。

<br>

------

## 玩家对象 API

在LXL中，使用「玩家对象」来操作和获取某一个玩家的相关信息。

### 获取一个玩家对象

获取玩家对象有三种方式：

1. 通过注册**事件监听**函数，获取到BDS给出的与相关事件有关的玩家对象  
   详见[事件监听文档 - EventAPI](EventApi.md)

   

2. 通过**玩家名**或者**xuid**手动生成玩家对象  
   通过此函数来手动生成对象，注意，你要获取的玩家必须是在线状态，否则会生成失败

   `mc.getPlayer(info)`

   - 参数：
     - info : `String`  
       玩家的名字或者Xuid
   - 返回值：生成的玩家对象 
   - 返回值类型：`Player`
     - 如返回值为 `Null` 则表示获取玩家失败

   

3. 获取**所有在线玩家**的列表  
   此函数会返回一个玩家对象的数组，其中每个对象都对应了一个服务器中的玩家

   `mc.getOnlinePlayers()`

   - 返回值：在线的玩家对象列表
   - 返回值类型：`Array<Player,Player,...>`

<br>

### 玩家对象 - 属性

每一个玩家对象都包含一些固定的对象属性。对于某个特定的玩家对象`pl`，有以下这些属性

| 属性         | 含义                               | 类型       |
| ------------ | ---------------------------------- | ---------- |
| pl.name      | 玩家名                             | `String`   |
| pl.pos       | 玩家所在坐标                       | `FloatPos` |
| pl.realName  | 玩家的真实名字（即使改名后也不变） | `String`   |
| pl.xuid      | 玩家Xuid                           | `String`   |
| pl.uuid      | 玩家Uuid                           | `String`   |
| pl.ip        | 玩家设备的IP地址                   | `String`   |
| pl.maxHealth | 玩家最大生命值                     | `Integer`  |
| pl.health    | 玩家当前生命值                     | `Integer`  |
| pl.inAir     | 玩家当前是否悬空                   | `Boolean`  |
| pl.sneaking  | 玩家当前是否正在潜行               | `Boolean`  |

这些对象属性都是只读的，无法被修改

<br>

### 玩家对象 - 函数

每一个玩家对象都包含一些可以执行的成员函数（成员方法）。对于某个特定的玩家对象`pl`，可以通过以下这些函数对这个玩家进行一些操作

#### 判断玩家是否为OP  

`pl.isOP()`

- 返回值：玩家是否为OP
- 返回值类型：`Boolean`  

<br>

#### 断开玩家连接  

`pl.kick([msg])`

- 参数：
  - msg : `String`  
    （可选参数）被踢出玩家出显示的断开原因。  
    如果不传入，默认为“正在从服务器断开连接”  
- 返回值：是否成功断开连接
- 返回值类型：`Boolean`

<br>

#### 发送一个文本给玩家  

`pl.tell(msg[,type])`

- 参数：

  - msg : `String`  
    待发送的文本  

  - type : `Integer`  
    （可选参数）发送的文本消息类型，默认为0  

    | type参数 | 消息类型                |
    | -------- | ----------------------- |
    | 0        | 普通消息（Raw）         |
    | 1        | 聊天消息（Chat）        |
    | 5        | 物品栏上方的消息（Tip） |
    | 9        | Json格式消息（Json）    |

- 返回值：是否成功发送

- 返回值类型：`Boolean`

<br>

#### 以这个玩家身份执行一条命令 

`pl.runcmdAs(cmd)`

- 参数：
  - cmd : `String`  
    待执行的命令  
- 返回值：是否执行成功
- 返回值类型： `Boolean`   

<br>

#### 传送玩家至指定位置  

`pl.teleport(pos)`

- 参数：
  - pos : `FloatPos`  
    目标位置坐标 
- 返回值：是否成功传送
- 返回值类型：`Boolean`

<br>

#### 杀死玩家  

`pl.kill()`

- 返回值：是否成功执行
- 返回值类型：`Boolean`

<br>

#### 重命名玩家  

`pl.rename(newname)`

- 参数：
  - newname : `String`  
    玩家的新名字  
- 返回值：是否重命名成功
- 返回值类型：`Boolean`

<br>

#### 查询玩家背包  

`pl.getPack()`

- 返回值：玩家背包中所有的物品对象
- 返回值类型：`Array<Item,Item,...>`
  - 返回值数组中物品对象的排列顺序和背包中的顺序一致

<br>

#### 获取玩家主手物品  

`pl.getHand()`

- 返回值：玩家当前主手持有的物品对象
- 返回值类型：`Item`

<br>

#### 获取玩家副手物品  

`pl.getOffHand()`

- 返回值：玩家当前副手持有的物品对象
- 返回值类型：`Item`

<br>

#### 查询玩家操作权限  

`pl.getPlayerPermLevel()`

- 返回值：目标玩家的操作权限等级

- 返回值类型：`Integer`

  | 操作权限等级 | 对应操作权限    |
  | ------------ | --------------- |
  | 0            | 普通成员权限    |
  | 1            | OP权限          |
  | 4            | OP + 控制台权限 |

<br>

#### 修改玩家操作权限  

`pl.setPlayerPermLevel(level)`

- 参数：

  - level : `Integer`  
    目标操作权限等级  

    | 操作权限等级 | 对应操作权限    |
    | ------------ | --------------- |
    | 0            | 普通成员权限    |
    | 1            | OP权限          |
    | 4            | OP + 控制台权限 |

- 返回值：是否成功修改

- 返回值类型：`Boolean`

<br>

#### 提高玩家经验等级 

`pl.addLevel(count)`

- 参数：
  - count : `Integer`  
    要提升的经验等级
- 返回值：是否设置成功
- 返回值类型：`Boolean`

<br>

#### 传送玩家至指定服务器  

`pl.transServer(server,port)`

- 参数：
  - server : `String`  
    目标服务器IP / 域名

  - port : `Integer`  
    目标服务器端口  
- 返回值：是否成功传送
- 返回值类型：`Boolean` 

<br>

#### 获取玩家计分板值  

`pl.getScore(name)`

- 参数：
  - name : `String`  
    计分板名称  
- 返回值：计分板上的数值
- 返回值类型：`Integer`

<br>

#### 设置玩家计分板值  

`pl.setScore(name,value)`

- 参数：
  - name : `String`  
    计分板名称  

  - value : `Integer`  
    设置的数值  
- 返回值：是否设置成功
- 返回值类型：`Boolean`

如果你想删除这个计分板项，请在value参数传入`Null`

<br>

#### 给玩家计分板项加分 

`pl.addScore(name,value)`

- 参数：
  - name : `String`  
    计分板名称  

  - value : `Integer`  
    要增加的数值  
- 返回值：是否设置成功
- 返回值类型：`Boolean`

<br>

#### 移除玩家计分板项

`pl.removeScore(name)`

- 参数：
  - name : `String`  
    计分板名称  

- 返回值：是否移除成功
- 返回值类型：`Boolean`

<br>

#### 设置玩家自定义侧边栏计分板  

`pl.setScoreBoard(title,data)`

- 参数：

  - title : `String`  
    侧边栏标题  

  - data : `Array<Object<String,String>, Object<String,String>, ...>`  
    计分板对象数组  
    对于数组中的某个对象`item`，有下面这些成员  

    | 成员       | 含义               | 类型      |
    | ---------- | ------------------ | --------- |
    | item.title | 计分板显示项的名字 | `String`  |
    | item.value | 计分板显示项的数值 | `Integer` |

- 返回值：是否成功设置

- 返回值类型：`Boolean`

<br>

#### 移除玩家自定义侧边栏计分板  

`pl.removeScoreBoard()`

- 返回值：是否成功移除
- 返回值类型：`Boolean`

<br>

#### 设置玩家看到的自定义Boss血条  

`pl.setBossBar(title,percent)`

- 参数：
  - title : `String`  
    自定义血条标题  

  - percent : `Integer`  
    血条中的血量百分比，有效范围为0~100。0为空血条，100为满
- 返回值：是否成功设置
- 返回值类型：`Boolean`

<br>

#### 移除玩家的自定义Boss血条  

`pl.removeBossBar()`

- 返回值：是否成功移除
- 返回值类型：`Boolean`

<br>

### 玩家对象 - 附加数据

在实际开发中，经常有需要将某些数据和服务器中的某个玩家相关联，并在插件的工作周期中不断维护这些数据的需求。  
LXL为此设计了玩家附加数据接口，给予在整个生命周期中跟踪某个特定玩家相关数据的能力。附加数据储存接口使用键 - 值对的形式保存数据。  
即使在玩家对象超出作用域被销毁之后，玩家附加数据将仍然存在，当你再次获得这个玩家的玩家对象的时候，同样可以读取到之前储存的附加数据。只有当服务端关闭的时候，所有的数据才会被统一销毁。

对于某个特定的玩家对象`pl`，有如下这些接口：

#### 储存玩家附加数据

`pl.setExtraData(name,data)`

- 参数：
  - name : `String`  
    要储存到附加数据的名字
  - data : `任意类型`  
    你要储存的附加数据，可以是`Null`

- 返回值：是否成功储存
- 返回值类型：`Boolean` 

<br>

#### 获取玩家附加数据

`pl.getExtraData(name)`

- 参数：
  - name : `String`  
    要读取的附加数据的名字
- 返回值：储存的附加数据
- 返回值类型：`任意类型`，取决于储存的数据类型
  -  如返回值为 `Null` 则表示未获取到指定的附加数据，或者数据为空

<br>

#### 删除玩家附加数据

`pl.delExtraData(name)`

- 参数：
  - name : `String`  
    要删除的附加数据的名字
- 返回值：是否删除成功
- 返回值类型：`Boolean`

<br>

#### 注：数据储存的可持续性

在设计附加数据接口的时候，LXL特地实现了这种机制：  
附加数据不会随着玩家离开服务器而清除，当某个玩家再次进服的时候，`getExtraData`可能会读到他上次在服里的时候储存的附加数据。  
LXL特地通过这种效果来达到**可持续性**的要求，即在插件的整个生命周期内持续跟踪特定玩家的数据。  
注意，如果这种效果可能对你造成影响，可能需要你做手动做一些额外的处理

<br>

------

## 方块对象 API

在LXL中，使用「方块对象」来操作和获取某一个方块的相关信息。

### 获取一个方块对象

获取玩家对象有两种方式：

1. 通过注册**事件监听**函数，或者调用某些**返回方块对象**的函数，获取到BDS给出的与相关事件有关的方块对象  
   详见[事件监听文档 - EventAPI](EventApi.md)

2. 通过**方块坐标**手动生成方块对象  
   通过此函数来手动生成对象，注意，你要获取的方块必须处于已被加载的范围中，否则会出现问题

   `mc.getBlock(pos)`

   - 参数：
     - pos : `IntPos`  
       方块坐标
   - 返回值：生成的方块对象 
   - 返回值类型：`Block`
     - 如返回值为 `Null` 则表示获取方块失败

<br>


### 方块对象 - 属性

每一个方块对象都包含一些固定的对象属性。对于某个特定的方块对象`bl`，有以下这些属性

| 属性          | 含义                     | 类型     |
| ------------- | ------------------------ | -------- |
| bl.name       | 方块名称                 | `String` |
| bl.customName | 游戏内实际显示的方块名称 | `String` |
| bl.pos        | 方块所在坐标             | `IntPos` |

这些对象属性都是只读的，无法被修改

<br>

------

## 物品对象 API

在LXL中，使用「物品对象」来操作和获取某一个物品栏物品的相关信息。

### 获取一个物品对象

通过注册**事件监听**函数，或者调用某些**返回物品对象**的函数，来获取到BDS给出的物品对象  

<br>


### 物品对象 - 属性

每一个物品对象都包含一些固定的对象属性。对于某个特定的物品对象`it`，有以下这些属性

| 属性          | 含义                     | 类型      |
| ------------- | ------------------------ | --------- |
| it.name       | 物品名称                 | `String`  |
| it.customName | 游戏内实际显示的物品名称 | `String`  |
| it.count      | 这个物品对象堆叠的个数   | `Integer` |
| it.aux        | 物品附加值（如羊毛颜色） | `Integer` |

这些对象属性都是只读的，无法被修改

<br>

### 物品对象 - 函数

每一个物品对象都包含一些可以执行的成员函数（成员方法）。对于某个特定的物品对象`it`，可以通过以下这些函数对这个物品进行一些操作

#### 判断物品对象是否为空

`it.isNull()`

- 返回值：这个物品对象是否为空
- 返回值类型： `Boolean`
  - 比如说当这个格子没有任何物品的时候，你获取到的物品对象即是空

<br>

#### 设置自定义Lore

`it.setLore(names)`

- 参数：
  - names : `Array<String,String,...>`  
    要设置的Lore字符串的数组
- 返回值：是否设置成功
- 返回值类型： `Boolean`

<br>

------

## 实体对象 API

在LXL中，使用「实体对象」来操作和获取某一个实体的相关信息。

### 获取一个实体对象

通过注册**事件监听**函数，或者调用某些**返回实体对象**的函数，来获取到BDS给出的实体对象  

<br>


### 实体对象 - 属性

每一个实体对象都包含一些固定的对象属性。对于某个特定的实体对象`en`，有以下这些属性

| 属性         | 含义             | 类型       |
| ------------ | ---------------- | ---------- |
| en.name      | 实体名称         | `String`   |
| en.pos       | 实体所在坐标     | `FloatPos` |
| en.maxHealth | 实体最大生命值   | `Integer`  |
| en.health    | 实体当前生命值   | `Integer`  |
| en.inAir     | 实体当前是否悬空 | `Boolean`  |

这些对象属性都是只读的，无法被修改

<br>

### 实体对象 - 函数

每一个实体对象都包含一些可以执行的成员函数（成员方法）。对于某个特定的实体对象`en`，可以通过以下这些函数对这个实体进行一些操作

#### 传送实体至指定位置  

`en.teleport(pos)`

- 参数：
  - pos : `FloatPos`  
    目标位置坐标
- 返回值：是否成功传送
- 返回值类型：`Boolean`

<br>

#### 杀死指定实体  

`en.kill()`

- 返回值：是否成功执行
- 返回值类型：`Boolean`

<br>

------

## 服务器设置 API

下面这些API提供了自定义某些服务器设置的接口

### 设置服务器Motd字符串  

`mc.setMotd(motd)`

- 参数：
  - motd : `String`  
    目标Motd字符串  
- 返回值：是否设置成功
- 返回值类型：`Boolean`

<br>

### 设置服务器自定义在线人数 

`mc.setOnlinePlayer(nowCount,maxCount)`

- 参数：
  - nowCount : `Integer`  
    当前在线人数  
  - maxCount : `Integer`  
    最大在线人数  
- 返回值：是否设置成功
- 返回值类型：`Boolean`

<br>

### 自定义服务器在线人数信息  

`mc.setServerOnline(motd)`

- 参数：
  - motd : `String`  
    目标Motd字符串  
- 返回值：是否设置成功
- 返回值类型：`Boolean`

<br>

[<< 返回目录](README.md)