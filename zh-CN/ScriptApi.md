# LiteXLoader - 脚本辅助接口文档

[<< 返回目录](README.md)

下列这些内容，为脚本插件提供了大量的**辅助功能**，包括日志功能、异步接口等等。  
他们让你开发脚本变得更加容易而自然，避免了很多无谓的细节问题的纠缠。

<br>

## 输出信息到控制台

这是为了方便输出信息而设计的便捷函数

`log(data1,data2,...)` (Lua环境下别名：`print`)

- 参数：
  - 待输出的变量或者数据  
    可以是任意类型，参数数量可以是任意个
- 返回值：无

<br>

------

## 脚本辅助 API

下面这些API为脚本增加了必要的辅助接口，以及LXL加载器相关的接口

### 推迟一段时间执行函数  

`setTimeout(func,msec)`

- 参数：

  - func : `Function`  
    待执行的函数

  - msec : `Integer`  
    推迟执行的时间（毫秒）
- 返回值：此任务ID
- 返回值类型：`Integer`

> 推迟执行的函数可能与其他线程代码同时执行，使用时注意潜在的数据竞争和死锁问题  

<br>

### 推迟一段时间执行代码段（eval）  

`setTimeout(code,msec)`

- 参数：

  - code : `String`  
    待执行的代码段

  - msec : `Integer`  
    推迟执行的时间（毫秒）
- 返回值：此任务ID
- 返回值类型：`Integer`

> 推迟执行的代码可能与其他线程代码同时执行，使用时注意潜在的数据竞争和死锁问题  

<br>

### 设置周期执行函数  

`setInterval(func,msec)`

- 参数：
  - func : `Function`  
    待执行的函数

  - msec : `Integer`  
    执行间隔周期（毫秒）
- 返回值：此任务ID
- 返回值类型： `Integer`

> 周期执行的函数可能与其他线程代码同时执行，使用时注意潜在的数据竞争和死锁问题  

<br>

### 设置周期执行代码段（eval）  

`setInterval(code,msec)`

- 参数：
  - code : `String`  
    待执行的代码段

  - msec : `Integer`  
    执行间隔周期（毫秒）
- 返回值：此任务ID
- 返回值类型： `Integer`

> 周期执行的代码可能与其他线程代码同时执行，使用时注意潜在的数据竞争和死锁问题   

<br>

### 取消延时 / 周期执行项  

`clearInterval(taskid)`

- 参数：
  - timerid : `Integer`  
    由前几个函数返回的任务ID
- 返回值：是否取消成功
- 返回值类型： `Boolean`

<br>

### 启动一个新的脚本插件

`loadPlugin(path)`

- 参数：
  - path : `String`  
    要加载的插件文件路径（如`addplugin.js`)

- 返回值：是否启动成功
- 返回值类型： `Boolean`

注：此函数仅用于运行时动态加载插件。若需要导入外部代码，请用各自语言的import或者require  
只能加载与当前开发语言相同的插件，比如说在js插件中不能动态加载.lua文件

<br>

### 获取LiteXLoader加载器版本

`getLxlVersion()`

- 返回值：加载器版本号，格式`主版本.次版本.开发版本`。如`1.0.1`
- 返回值类型： `String`

<br>

------

## 通用日志接口

以往，按某种格式输出日志到指定位置是一件非常麻烦的事情。  
如今，LXL为你提供了方便的通用日志接口。  

### 设置输出位置

在使用通用日志接口之前，你需要先按你的需求设置一下日志输出到哪些地方

你可以通过修改设置，自由选择将日志发向控制台、文件甚至某个玩家  
这些设置是可以同时存在的，比如说，你可以设置同时发送到控制台和文件  
如果你不修改任何设置，默认情况下，日志仅会输出到控制台。

#### 设置日志是否输出到控制台

`logger.setConsole(isTo)`

- 参数：
  - isTo : `Boolean`  
    设置日志是否输出到控制台  
    开关默认是打开状态。
- 返回值：无

<br>

#### 设置日志是否输出到文件

`logger.setFile(filepath)`

- 参数：
  - filepath : `String`  
    设置日志输出到的文件路径  
    如果传入空字符串或者null，则代表关闭输出到文件。  
    开关默认是关闭状态
- 返回值：无

如果要输出到文件，我们提倡您将日志统一输出到`BDS根目录/logs/`文件夹下，以方便整理和检查。

<br>

#### 设置日志是否输出到某个玩家

`logger.setPlayer(player)`

- 参数：
  - player : `Player`  
    设置日志输出到的目标玩家对象  
    如果传入null，则代表关闭输出到玩家。默认为关  
- 返回值：无

这是为了方便游戏内调试而设计的功能，输出到玩家的日志会被当作聊天消息，显示在目标玩家的屏幕上

<br>

 ### 输出日志函数

在设置完毕之后，你就可以用这里的函数输出日志了

`logger.log(data1,data2,...)` -> 输出普通文本  
`logger.debug(data1,data2,...)` -> 输出调试信息  
`logger.info(data1,data2,...)`  -> 输出提示信息  
`logger.warn(data1,data2,...)`  -> 输出警告信息  
`logger.error(data1,data2,...)`  -> 输出错误信息  
`logger.fatal(data1,data2,...)`  -> 输出严重错误信息

- 参数：
  - 待输出的变量或者数据  
    可以是任意类型，参数数量可以是任意个
- 返回值：无

其中，**普通文本**在输出的时候会按照原样输出，而其他的各个输出接口都会在日志内容前面附加上**当前时间和日志类型**  
例如：你调用`logger.error("Fail to transport the player")`  
日志输出的结果是 

```
[2021-05-21 19:41:03 Error] Fail to transport the player
```

<br>

### 其他的一些设置项

除此之外，还有其他的一些设置项，用来改变输出日志的格式

#### 设置自定义日志消息标头  

`logger.setTitle(title)`

- 参数：
  - title : `String`  
    设置的自定义标头
- 返回值：无

「标头」为日志输出条目开头的文字，用来直观地区分日志的输出源。  
默认情况下，消息标头默认为空，即输出时没有标头。

例如：设置自定义标头为`logger.setTitle("LiteXLoader")`  
则在接下来的日志输出将变为形如：  

```
[LiteXLoader] [2021-05-21 19:41:03 Error] Fail to transport the player
```

如果在设置之后想要关闭标头，请执行`logger.setTitle("")`

<br>

#### 设置日志最小输出等级

`logger.setLogLevel(level)`

- 参数：
  - level : `Number`  
    日志的最小输出等级    
- 返回值：无

只有**大于等于**最小输出等级的日志才会被输出。由此，你可以很方便地统一屏蔽一些你不想看到的内容  
日志类型与输出等级对照表如下

| 日志输出等级 | 0          | 1         | 2         | 3          | 4              | 5            |
| ------------ | ---------- | --------- | --------- | ---------- | -------------- | ------------ |
| 日志类型     | Debug 调试 | Info 提示 | Warn 警告 | Error 错误 | Fatal 严重错误 | 禁止所有日志 |

默认最小日志输出等级为1，即输出除了调试信息以外所有种类的日志  
除此之外，普通文本日志`logger.log`将总是被输出，不受这里的影响

<br>

[<< 返回目录](README.md)